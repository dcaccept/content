---
- name: Gather VLAN Information
  hosts: switches
  gather_facts: no
  connection: network_cli
  tasks:
    - name: Retrieve VLAN information
      ios_command:
        commands:
          - show vlan brief
      register: vlan_output

    - name: Extract VLAN ID and Name
      set_fact:
        vlan_info: "{{ vlan_output.stdout[0] | regex_findall('^(\\d+)\\s+(\\S+.*\\S+)\\s+\\S+\\s+\\S+', multiline=True) }}"

    - name: Display VLAN Information
      debug:
        msg: "{{ vlan_info }}"

          {% set blocks = re.findall(r'(interface Vlan\d+.*?)(?=\s*!|$)', config_text, re.DOTALL) %}
          {% set result = [] %}
          {% for block in blocks %}
            {% set vlan_id = re.search(r'interface (\S+)', block).group(1) %}
            {% set description = re.search(r'description (.+)', block) %}
            {% set description_text = description.group(1) if description else '' %}
            {% set ip_address = re.search(r'ip address (\S+)', block) %}
            {% set ip_address_text = ip_address.group(1) if ip_address else '' %}
            {% set subnet = re.search(r'ip address \S+ (\S+)', block) %}
            {% set subnet_text = subnet.group(1) if subnet else '' %}
            {% set helper_ips = re.findall(r'ip helper-address (\S+)', block) %}
            {% set helper_ips_text = ', '.join(helper_ips) %}
            {% do result.append([vlan_id, ip_address_text, description_text, subnet_text, helper_ips_text]) %}
          {% endfor %}
          {{ result }}
